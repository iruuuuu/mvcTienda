<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos</title>

</head>
<body>
<?php
 // Comprobamos si la sesión de usuario está iniciada y es un objeto
 if(isset($_SESSION['user']) && is_object($_SESSION['user'])){
        if ($_SESSION['user']->getAvatar()) {
        $img = $_SESSION['user']->getAvatar();
    } else $img = "avatar.jpg";

    // Mostramos la imagen y el saludo en la misma línea, dentro del mismo H3
    echo '<h3><img src="public/users/' . htmlspecialchars($img) . '" width="50px" style="vertical-align: middle; margin-right: 10px;">' .
         'Hola ' . htmlspecialchars($_SESSION['user']->getUsername()) . '. <a href="index.php?c=user&logout=1">Salir</a></h3>';
    
    // Agrupamos los enlaces de navegación en un div para una mejor estructura
    echo '<div>';
    echo '<a href="index.php?c=products&newProduct=1">Crear Producto</a><br>';
    echo '<a href="index.php?c=user&edit=1">Panel de usuario</a><br>';
    echo '<a href="index.php?c=pedido">Carrito de pedidos</a><br>';
    echo '</div>';
    }else{
        // Enlaces para usuarios no logueados
        echo '<a href="index.php?c=user&register=1">registrarse</a><br>';
        echo '<a href="index.php?c=user&login=1">iniciar sesión</a><br>';
    }
?>

    <h2>Productos</h2>
    <?php if (isset($products) && count($products) > 0): ?>
        <?php foreach ($products as $product): ?>
            <div style="border: 1px solid #6c6c6cff; padding: 10px; margin: 10px 0;">
                <h3><?php echo htmlspecialchars($product->getName()); ?></h3>
                
                <!-- AQUI PONER LA IMAGEN -->
                <?php if ($product->getImage()): ?>
                    <img src="public/products/<?php echo htmlspecialchars($product->getImage()); ?>" 
                         alt="<?php echo htmlspecialchars($product->getName()); ?>" 
                         width="100px" 
                         style="margin-bottom: 10px;">
                <?php else: ?>
                    <p>No hay imagen disponible.</p>
                <?php endif; ?>
                
                <p><strong>Descripción:</strong> <?php echo htmlspecialchars($product->getDescription()); ?></p>
                <!-- Agrega aquí cualquier otra información relevante del producto -->
                <p><strong>Stock:</strong> <?php echo htmlspecialchars($product->getStock()); ?></p>
                <?php 
                if (isset($_SESSION['user']) && is_object($_SESSION['user'])):
                    
                     echo '<a href="index.php?c=products&productId=' . htmlspecialchars($product->getId()) . '">Añadir a pedidos</a>';

                    if ($_SESSION['user']->isAdmin()):
                ?>
                    <!-- Formulario POST para eliminar producto (seguridad CSRF) -->
                    <form action="index.php?c=products&action=delete" method="POST" style="display: inline; margin-left: 10px;">
                        <input type="hidden" name="id" value="<?php echo htmlspecialchars($product->getId()); ?>">
                        <button type="submit" onclick="return confirm('¿Estás seguro de eliminar este producto?')" style="background:none; border:none; color:blue; text-decoration:underline; cursor:pointer;">
                            [Eliminar Producto]
                        </button>
                    </form>
                <?php 
                    endif;
                endif; 
                ?>
            </div>
        <?php endforeach; ?>
    <?php else: ?>
        <p>No hay productos aun.</p>
    <?php endif; ?>
</body>
</html>